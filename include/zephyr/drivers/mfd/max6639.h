/*
 * Copyright (c) 2025 Tenstorrent AI ULC
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef ZEPHYR_INCLUDE_DRIVERS_MFD_MAX6639_H_
#define ZEPHYR_INCLUDE_DRIVERS_MFD_MAX6639_H_

#include <zephyr/drivers/sensor.h>
#include <zephyr/sys/util.h>
#include <zephyr/sys/util_macro.h>

#define MAX6639_PWM_PERIOD 120
#define MAX6639_RPM_RANGE  16000

#define MAX6639_REG_GLOBAL_CONFIG_PWM_FREQUENCY_SHIFT 3
#define MAX6639_CONFIG_3_PWM_FREQUENCY_MASK           3
#define MAX6639_EXTENDED_TEMP_SHIFT                   5

#define MAX6639_LOW_FREQ_00_FREQ 20
#define MAX6639_LOW_FREQ_01_FREQ 33
#define MAX6639_LOW_FREQ_10_FREQ 50
#define MAX6639_LOW_FREQ_11_FREQ 100

#define MAX6639_HIGH_FREQ_00_FREQ 5000
#define MAX6639_HIGH_FREQ_01_FREQ 8330
#define MAX6639_HIGH_FREQ_10_FREQ 12500
#define MAX6639_HIGH_FREQ_11_FREQ 25000

/* Registers */
#define MAX6639_REG_CHANNEL_1_TEMP 0x00
#define MAX6639_REG_CHANNEL_2_TEMP 0x01

#define MAX6639_REG_GLOBAL_CONFIG 0x04

#define MAX6639_REG_CHANNEL_1_TEMP_EXTENDED 0x05
#define MAX6639_REG_CHANNEL_2_TEMP_EXTENDED 0x06

#define MAX6639_REG_CHANNEL_1_CONFIG_1  0x10
#define MAX6639_REG_CHANNEL_1_CONFIG_2A 0x11
#define MAX6639_REG_CHANNEL_1_CONFIG_3  0x13
#define MAX6639_REG_CHANNEL_2_CONFIG_1  0x14
#define MAX6639_REG_CHANNEL_2_CONFIG_2A 0x15
#define MAX6639_REG_CHANNEL_2_CONFIG_3  0x17

#define MAX6639_REG_CHANNEL_1_TACH 0x20
#define MAX6639_REG_CHANNEL_2_TACH 0x21

#define MAX6639_REG_CHANNEL_1_DUTY_CYCLE 0x26
#define MAX6639_REG_CHANNEL_2_DUTY_CYCLE 0x26

enum max6639_sensor_channel {
	MAX6639_CHAN_1_RPM = SENSOR_CHAN_PRIV_START,
	MAX6639_CHAN_1_DUTY_CYCLE,
	MAX6639_CHAN_1_TEMP,
	MAX6639_CHAN_2_RPM,
	MAX6639_CHAN_2_DUTY_CYCLE,
	MAX6639_CHAN_2_TEMP,
};

#endif /* ZEPHYR_INCLUDE_DRIVERS_MFD_MAX6639_H_ */
